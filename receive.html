<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Share : Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background-color: #000; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .video-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; }
        video { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; }
    </style>
</head>
<body class="text-white">

    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center p-4 z-50">
        <div class="max-w-sm w-full bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700 text-center">
            <h1 class="text-2xl font-bold mb-2 text-cyan-400">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</h1>
            <p class="text-gray-400 text-xs mb-6">‡∏Å‡∏£‡∏≠‡∏Å ID ‡∏à‡∏≤‡∏Å Host ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ä‡∏°</p>

            <input type="text" id="remote-id-input" placeholder="‡∏ß‡∏≤‡∏á Connection ID ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." class="w-full bg-gray-900 border border-gray-600 text-white text-center text-lg font-mono rounded-lg px-4 py-3 mb-4 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition">

            <button id="btn-connect" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition transform hover:scale-105">
                üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            </button>
            <p id="status-log" class="text-xs text-red-400 mt-4 h-4"></p>
        </div>
    </div>

    <!-- Video Area -->
    <div class="video-container">
        <video id="remote-video" autoplay playsinline controls></video>
    </div>

    <!-- Overlay -->
    <div id="controls-overlay" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800/80 backdrop-blur px-6 py-2 rounded-full hidden flex gap-4">
        <button onclick="toggleFullScreen()" class="hover:text-cyan-400 transition">‚õ∂ Fullscreen</button>
        <span class="text-gray-500">|</span>
        <button onclick="location.reload()" class="text-red-400 hover:text-red-300 transition">Disconnect</button>
    </div>

    <script>
        const loginScreen = document.getElementById('login-screen');
        const remoteIdInput = document.getElementById('remote-id-input');
        const btnConnect = document.getElementById('btn-connect');
        const remoteVideo = document.getElementById('remote-video');
        const statusLog = document.getElementById('status-log');
        const controlsOverlay = document.getElementById('controls-overlay');

        let peer = null;

        // Init PeerJS
        peer = new Peer(null, { debug: 1 });

        // 1. ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Host (‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
        peer.on('call', (call) => {
            console.log("Incoming call from Host...");
            statusLog.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏†‡∏≤‡∏û...";
            statusLog.className = "text-xs text-blue-400 mt-4 h-4 animate-pulse";
            
            // ‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢ (Answer)
            call.answer(); 
            
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ñ‡∏∂‡∏á
            call.on('stream', (remoteStream) => {
                console.log("Stream Received!");
                loginScreen.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login
                controlsOverlay.classList.remove('hidden');
                controlsOverlay.style.display = 'flex';
                
                remoteVideo.srcObject = remoteStream;
                remoteVideo.play().catch(e => console.error("Autoplay blocked:", e));
            });

            call.on('close', () => {
                alert("Host ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß");
                location.reload();
            });
        });

        btnConnect.addEventListener('click', () => {
            const hostId = remoteIdInput.value.trim();
            if (!hostId) {
                statusLog.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ID ‡∏Ñ‡∏£‡∏±‡∏ö";
                return;
            }

            statusLog.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Host...";
            statusLog.className = "text-xs text-yellow-400 mt-4 h-4";
            btnConnect.disabled = true;
            btnConnect.classList.add('opacity-50');

            // 2. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Data Connection ‡πÑ‡∏õ‡∏´‡∏≤ Host ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
            const conn = peer.connect(hostId);

            conn.on('open', () => {
                statusLog.innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠ Host ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û...";
                statusLog.className = "text-xs text-green-400 mt-4 h-4";
            });

            conn.on('data', (data) => {
                if(data.msg) {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Host (‡πÄ‡∏ä‡πà‡∏ô "‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...")
                    statusLog.innerText = data.msg;
                }
            });
            
            conn.on('error', (err) => {
                console.error(err);
                statusLog.innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (ID ‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠ Host ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà)";
                statusLog.className = "text-xs text-red-400 mt-4 h-4";
                btnConnect.disabled = false;
                btnConnect.classList.remove('opacity-50');
            });
        });

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }
    </script>
</body>
</html>